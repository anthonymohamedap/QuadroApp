<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="clr-namespace:QuadroApp.ViewModels"
    xmlns:m="clr-namespace:QuadroApp.Model"
    x:Class="QuadroApp.Views.AfwerkingenView"
    x:DataType="viewmodels:AfwerkingenViewModel"
    Padding="0"
    Background="#1E1F23">

	<!-- Styles: geen x:Key, alleen Selector -->
	<UserControl.Styles>
		<Style Selector="TextBlock.h1">
			<Setter Property="FontSize" Value="22"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="#FFFFFF"/>
		</Style>

		<Style Selector="TextBlock.section">
			<Setter Property="FontSize" Value="18"/>
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Foreground" Value="#222222"/>
			<Setter Property="Margin" Value="0,6,0,10"/>
		</Style>

		<Style Selector="TextBlock.label">
			<Setter Property="Foreground" Value="#666666"/>
			<Setter Property="FontSize" Value="12"/>
			<Setter Property="Margin" Value="0,6,0,4"/>
		</Style>

		<Style Selector="Border.card">
			<Setter Property="CornerRadius" Value="12"/>
			<Setter Property="Background" Value="#FFFFFF"/>
			<Setter Property="BorderBrush" Value="#E5E7EB"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="16"/>
		</Style>
	</UserControl.Styles>

	<Grid RowDefinitions="Auto,*">
		<!-- Header -->
		<Border Background="#2E3239" Padding="14,10" BorderBrush="#000000" BorderThickness="0,0,0,1">
			<DockPanel>
				<TextBlock Classes="h1" Text="Afwerkingen" DockPanel.Dock="Left"/>
				<StackPanel Orientation="Horizontal" Spacing="8" DockPanel.Dock="Right">
					<Button Content="⬅️ Terug"
										Command="{Binding GaTerugCommand}"
										DockPanel.Dock="Right"
										VerticalAlignment="Top"
										HorizontalAlignment="Right"
										Margin="0,10,10,0"
										Background="#F5C242"
										Foreground="#222"
										FontWeight="Bold"
										CornerRadius="8"
										Padding="10,5"
										Width="100"
										Height="32"/>					
					<Button Content="Verversen" Command="{Binding RefreshAsyncCommand}" />
					<Button Content="Nieuw" Command="{Binding NewAsyncCommand}" />
					<Button Content="Opslaan" Command="{Binding SaveAsyncCommand}" />
					<Button Content="Verwijderen" Command="{Binding DeleteAsyncCommand}" />
				</StackPanel>
			</DockPanel>
		</Border>

		<!-- Content -->
		<Grid Grid.Row="1" ColumnDefinitions="380,*" Margin="16" ColumnSpacing="12">

			<!-- Linkerkolom -->
			<Border Classes="card">
				<StackPanel Spacing="10">
					<!-- Filters -->
					<StackPanel Spacing="8">
						<TextBlock Classes="label" Text="Groep"/>
						<ComboBox
							ItemsSource="{Binding Groepen}"
							SelectedItem="{Binding SelectedGroep}">
							<ComboBox.ItemTemplate>
								<DataTemplate x:DataType="m:AfwerkingsGroep">
									<TextBlock Text="{Binding Naam}"/>
								</DataTemplate>
							</ComboBox.ItemTemplate>
						</ComboBox>

						<TextBlock Classes="label" Text="Zoek optie"/>
						<TextBox Watermark="Zoek op code of naam…" Text="{Binding Zoekterm, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

						<TextBlock Text="{Binding AantalOptiesText}" Foreground="#888888" />
					</StackPanel>

					<!-- Lijst -->
					<Border Background="#F7F7F9" CornerRadius="10" Padding="6" Margin="0,6,0,0">
						<ListBox
							ItemsSource="{Binding FilteredOpties}"
							SelectedItem="{Binding SelectedOptie}"
							ScrollViewer.VerticalScrollBarVisibility="Auto">
							<ListBox.ItemTemplate>
								<DataTemplate x:DataType="m:AfwerkingsOptie">
									<Border Padding="8" CornerRadius="8" Background="Transparent">
										<Grid ColumnDefinitions="Auto,*,Auto">
											<TextBlock Text="{Binding Volgnummer}" FontWeight="SemiBold" Margin="0,0,10,0" />
											<TextBlock Text="{Binding Naam}" Foreground="#333333" />
											<TextBlock Text="{Binding Leverancier.Code}" Foreground="#888888" />
										</Grid>
									</Border>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</Border>

					<!-- Status & fout -->
					<TextBlock Text="{Binding Status}" Foreground="#666666" />
					<TextBlock Text="{Binding Foutmelding}" Foreground="Red" FontWeight="Bold" TextWrapping="Wrap"/>
				</StackPanel>
			</Border>

			<!-- Rechterkolom -->
			<Border Grid.Column="1" Classes="card">
				<ScrollViewer VerticalScrollBarVisibility="Auto">
					<StackPanel Spacing="16">

						<!-- Basis -->
						<StackPanel>
							<TextBlock Classes="section" Text="Basis"/>
							<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="10">

								<TextBlock Grid.Row="0" Grid.Column="0" Classes="label" Text="Naam"/>
								<TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedOptie.Naam, Mode=TwoWay}"/>

								<TextBlock Grid.Row="1" Grid.Column="0" Classes="label" Text="Code"/>
								<TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedOptie.Volgnummer, Mode=TwoWay}"/>

								<TextBlock Grid.Row="2" Grid.Column="0" Classes="label" Text="Leverancier"/>
								<ComboBox Grid.Row="2" Grid.Column="1"
										  ItemsSource="{Binding Leveranciers}"
										  SelectedItem="{Binding SelectedLeverancier}">
									<ComboBox.ItemTemplate>
										<DataTemplate x:DataType="m:Leverancier">
											<TextBlock Text="{Binding Code}" />
										</DataTemplate>
									</ComboBox.ItemTemplate>
								</ComboBox>

								<TextBlock Grid.Row="3" Grid.Column="0" Classes="label" Text="Dealeroptie"/>
								<ToggleSwitch Grid.Row="3" Grid.Column="1" IsChecked="{Binding IsDealerOptie}" IsEnabled="False"/>

								<TextBlock Grid.Row="4" Grid.Column="0" Classes="label" Text="Serie/opmerking"/>
								<TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SerieOpmerking, Mode=TwoWay}"/>
							</Grid>
						</StackPanel>

						<Separator/>

						<!-- Prijs &amp; werk -->
						<StackPanel>
							<TextBlock Classes="section" Text="Prijs &amp; werk"/>
							<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="10">

								<TextBlock Grid.Row="0" Grid.Column="0" Classes="label" Text="Kostprijs per m² (€)"/>
								<NumericUpDown Grid.Row="0" Grid.Column="1"
											   Value="{Binding SelectedOptie.KostprijsPerM2, Mode=TwoWay}"
											   Increment="0.5"
											   FormatString="0.00"/>

								<TextBlock Grid.Row="1" Grid.Column="0" Classes="label" Text="Winstmarge (factor)"/>
								<NumericUpDown Grid.Row="1" Grid.Column="1"
											   Value="{Binding SelectedOptie.WinstMarge, Mode=TwoWay}"
											   Increment="0.05"
											   FormatString="0.000"/>

								<TextBlock Grid.Row="2" Grid.Column="0" Classes="label" Text="Afval (%)"/>
								<NumericUpDown Grid.Row="2" Grid.Column="1"
											   Value="{Binding SelectedOptie.AfvalPercentage, Mode=TwoWay}"
											   Increment="1"
											   FormatString="0.00"/>

								<TextBlock Grid.Row="3" Grid.Column="0" Classes="label" Text="Vaste kost (€)"/>
								<NumericUpDown Grid.Row="3" Grid.Column="1"
											   Value="{Binding SelectedOptie.VasteKost, Mode=TwoWay}"
											   Increment="0.5"
											   FormatString="0.00"/>

								<TextBlock Grid.Row="4" Grid.Column="0" Classes="label" Text="Werkminuten"/>
								<NumericUpDown Grid.Row="4" Grid.Column="1"
											   Value="{Binding SelectedOptie.WerkMinuten, Mode=TwoWay}"
											   Increment="1"/>

							</Grid>
						</StackPanel>

						<Separator/>

						<!-- Preview -->
						<StackPanel>
							<TextBlock Classes="section" Text="Prijsberekening (preview)"/>
							<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="10">
								<TextBlock Grid.Row="0" Grid.Column="0" Classes="label" Text="Breedte (cm)"/>
								<NumericUpDown Grid.Row="0" Grid.Column="1"
											   Value="{Binding PreviewBreedteCm, Mode=TwoWay}"
											   Minimum="1" Maximum="300" Increment="1" FormatString="0"/>

								<TextBlock Grid.Row="1" Grid.Column="0" Classes="label" Text="Hoogte (cm)"/>
								<NumericUpDown Grid.Row="1" Grid.Column="1"
											   Value="{Binding PreviewHoogteCm, Mode=TwoWay}"
											   Minimum="1" Maximum="300" Increment="1" FormatString="0"/>

								<TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
										   FontWeight="SemiBold" Foreground="#0A7C3E"
										   Text="{Binding PreviewPrijsText}" />
							</Grid>
						</StackPanel>

					</StackPanel>
				</ScrollViewer>
			</Border>

		</Grid>
	</Grid>

	<!-- Resources -->
	<UserControl.Resources>
		<!-- (optioneel extra templates/brushes) -->
	</UserControl.Resources>
</UserControl>
